<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE document PUBLIC "-//APACHE//DTD Documentation V2.0//EN" "http://forrest.apache.org/dtd/document-v20.dtd">
<document>
  <header>
    <title>Translating Error Messages</title>
  </header>
  <body>

    <section id="overview">
      <title>Overview</title>
      <p>
        Translations of driver specific error messages are available in a
	number of languages.  The following information is about how to
	update an existing translation or to provide a translation to a new
	language.
      </p>
      <p>
	The translations are done using the
	<a href="http://www.gnu.org/software/gettext/gettext.html">GNU gettext</a>
	tools.  These are not required to build or use the driver, only
	translators and maintainers need them.
      </p>
    </section>

    <section id="devlopers">
      <title>Developers</title>
      <p>
        When writing code for the driver you need to specially mark strings
	for translation so they are picked up by the tools.  In general any
	user visible message should be made available for translation.
	Strings are marked using the
	<a href="privateapi/org/postgresql/util/GT.html">GT.tr</a>
	method.  The name means "gettext translate", but
	a shorter name was wanted because this shows up in a lot of places.
      </p>
      <p>
        To provide context sensitive information the standard Java
	<a href="http://java.sun.com/j2se/1.4.2/docs/api/java/text/MessageFormat.html">MessageFormat</a>
	syntax is used in the error messages.  Consider, for example,
	the error message for calling ResultSet.getInt() with an invalid
	column number, we want to helpfully report the column asked for and
	the number of columns in the ResultSet.
      </p>

<source><![CDATA[
if (column < 1 || column > fields.length) {
	String err = GT.tr(
		"The column index requested: {0} is out of range.",
		new Integer(column)
		);
	throw new PSQLException(err, PSQLState.INVALID_PARAMETER_VALID);
}
]]></source>
    </section>

    <section id="translators">
      <title>Translators</title>
      <p>
        The first thing to do is to check if an existing translation exists
	for your language, so you can update that instead of starting from
	scratch.  Check the
	<a href="http://gborg.postgresql.org/project/pgjdbc/cvs/cvs.php/pgjdbc/org/postgresql/translation">web view of the cvs repository</a>
	and see if a .po file exists for your language.  If there is one, you
	can download the latest version directly from there and start working
	on it.  To start a new translation you can download a
	<a href="messages.pot">template file</a>.
      </p>
      <p>
        Editing the .po file is a pretty straightforward process and a number
	of tools exist to aid you in the process:
      </p>
      <ul>
        <li>GNU Emacs and XEmacs have PO editing modes.</li>
        <li>
          <a href="http://i18n.kde.org/tools/kbabel/">KBabel</a>
          is a KDE-based editing tool.
        </li>
        <li>
          <a href="http://poedit.sourceforge.net/">poEdit</a>
          is another tool which can run on Windows.
        </li>
      </ul>
      <p>
        Once you feel the translation is accurate and complete (or you get
	tired), verify that the file by running <code>msgfmt</code>.
      </p>
      <source>msgfmt -c -v -o /dev/null pofile</source>
      <p>
        If everything checks out send the po file on over to
	<a href="mailto:pgsql-jdbc@postgresql.org">pgsql-jdbc@postgresql.org</a>.
      </p>
    </section>

    <section id="maintainers">
      <title>Maintainers</title>
      <p>
        To avoid requiring the gettext tools to compile the driver the
	decision has been made to directly check in the compiled message
	catalogs to the cvs repository.  When you get a new or updated
	translation, first ensure that it is valid by running the
	<code>msgfmt</code> command mentioned in the translators section.
	If this looks correct drop it into the
	<code>src/org/postgresql/translation</code>
	directory and run the <code>update-translations.sh</code> script
	in the top level directory.  This will produce the compiled class
	file that contains the translated messages.  Then simply check in
	both the .po and .class files.
      </p>
    </section>
      
  </body>
</document>

