<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE faqs PUBLIC "-//APACHE//DTD FAQ V1.2//EN" "http://forrest.apache.org/dtd/faq-v12.dtd" [
]>    

<faqs title="Frequently Asked Questions">
  <part id="xa">
    <title>XA</title>

    <faq id="xa-support">
      <question>Does the driver have XA support?</question>
      <answer>
        <p>
          Yes, starting with the 8.1dev-403 driver. However, transaction
	  interleaving is not supported.
        </p>
      </answer>
    </faq>
    <faq id="transaction-interleaving">
      <question>What is "transaction interleaving"?</question>
      <answer>
        <p>
	  Transaction interleaving means that one database connection can be
	  used for multiple transactions at the same time, switching between
	  the transactions.
	</p>
	<p>
	  Transaction interleaving is mostly useless, but it's a required part
	  of the JTA specification. Some application servers use it to allow a
	  bit more concurrency without allocating a bigger jdbc connection 
	  pool.
	</p>
	<p>
	  Few JDBC drivers support transaction interleaving properly. Some 
	  fake it by issuing early prepare commands, risking transaction
	  integrity, some give strange error messages, some fail in other,
	  subtle ways. The PostgreSQL JDBC driver does it's best to detect
	  interleaving and throws a proper error message when it can't do
	  what's requested.
	</p>
	<p>
	  Because of the lack of driver support, all of the popular application
	  servers provide options to work around it, or don't use it at all.
	  Therefore, lack of transaction interleaving shouldn't affect your
	  application or data integrity.
	</p>
	<p>
	  See the JTA specification, section 3.4.4, or search the pgsql-jdbc
	  mailing list archives for more information.
        </p>
      </answer>
    </faq>
  </part>

  <part id="problems">
    <title>Problems</title>
    
    <faq id="upgradeTo80">
      <question>
         I upgraded from 7.x to 8.x.  Why did my application break?
      </question>
      <answer>
        <p>
          By default, 8.x versions of the driver use protocol version 3 when
          communicating with servers 7.4 or higher.  This protocol allows for
          more efficient query execution and enables true server-side
          prepared statements, but also places some additional restrictions on
          queries.  Problems with upgrading the driver generally fall into one
          of two categories:
        </p>
        <p><strong>Parameter Typing.</strong> Previous versions of the driver
          sent all PreparedStatement parameters to the server as untyped 
          strings, and allowed the server to infer their types as appropriate.
          When running protocol version 3 however, the driver specifies the
          type of each parameter as it is being sent.  The upshot of this is 
          that code which was previously able to call (for example): 
          <code>PreparedStatement.setObject(1, "5")</code> to set an integer
          parameter now breaks, because setting a String value for an integer
          parameter is not allowed.
        </p>
        <p><strong>Parameter Position.</strong> Previous versions of the driver
          emulated PreparedStatements by performing string replacements
          each time the query was executed.  Newer drivers using protocol 3
          however actually use server-side prepared statements with
          placeholders for the positional parameters.  The upshot of this is
          that '?' positional parameters are now only allowed where the 
          PostgreSQL back-end allows parameters.
        </p>
        <p>In situations where it is difficult to modify the Java code and/or
          queries to work with the newer protocol version, it is possible to
          force the driver to use an older protocol version to restore the old
          behavior.  Look in the documentation for the 
          <code>protocolVersion</code> connection parameter.
        </p>
      </answer>
    </faq>
  </part>

</faqs>
